<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Usuario - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark shadow-sm mb-4">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="admin.html">üëü Admin Panel</a>
      <a class="btn btn-light btn-sm ms-auto" href="admin.html">Volver</a>
    </div>
  </nav>
  <div class="container py-4">
    <h2 class="mb-4">Editar Usuario</h2>
    <div id="usuarios-lista"></div>
    <div id="editar-form" class="mt-4"></div>
  </div>
  <script>
    function cargarUsuarios() {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const lista = document.getElementById('usuarios-lista');
      if (!usuarios.length) {
        lista.innerHTML = '<div class="alert alert-info">No hay usuarios para editar.</div>';
        return;
      }
      lista.innerHTML = '<h5>Selecciona un usuario para editar:</h5>' + usuarios.map((u, idx) => `
        <div class='card mb-2 p-2'>
          <b>${u.nombre}</b> (${u.correo})
          <button class='btn btn-warning btn-sm ms-2' onclick='editarUsuario(${idx})'>Editar</button>
        </div>
      `).join('');
    }
    function editarUsuario(idx) {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const u = usuarios[idx];
      document.getElementById('editar-form').innerHTML = `
        <form id='formEditarUsuario' class='border rounded-4 shadow-lg p-4 bg-white mx-auto' style='max-width: 600px;'>
          <div class='mb-3'><label class='form-label'>NOMBRE COMPLETO</label><input class='form-control' id='editNombre' value='${u.nombre || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CORREO</label><input class='form-control' id='editCorreo1' value='${u.correo || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CORREO</label><input class='form-control' id='editCorreo2' value='${u.correo || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CONTRASE√ëA</label><input type='password' class='form-control' id='editPassword1' value='' required></div>
          <div class='mb-3'><label class='form-label'>CONFIRMAR CONTRASE√ëA</label><input type='password' class='form-control' id='editPassword2' value='' required></div>
          <div class='mb-3'><label class='form-label'>TEL√âFONO (opcional)</label><input class='form-control' id='editTelefono' value='${u.telefono || ''}'></div>
          <div class='row mb-3'>
            <div class='col-md-6'>
              <label class='form-label'>Regi√≥n</label>
              <select class='form-select' id='editRegion' required>
                <option value=''>- Seleccione la regi√≥n -</option>
                <option value="Arica y Parinacota">Arica y Parinacota</option>
                <option value="Tarapac√°">Tarapac√°</option>
                <option value="Antofagasta">Antofagasta</option>
                <option value="Atacama">Atacama</option>
                <option value="Coquimbo">Coquimbo</option>
                <option value="Valpara√≠so">Valpara√≠so</option>
                <option value="Metropolitana">Regi√≥n Metropolitana de Santiago</option>
                <option value="O'Higgins">Libertador General Bernardo O'Higgins</option>
                <option value="Maule">Maule</option>
                <option value="√ëuble">√ëuble</option>
                <option value="Biob√≠o">Biob√≠o</option>
                <option value="Araucan√≠a">Araucan√≠a</option>
                <option value="Los R√≠os">Los R√≠os</option>
                <option value="Los Lagos">Los Lagos</option>
                <option value="Ays√©n">Ays√©n del General Carlos Ib√°√±ez del Campo</option>
                <option value="Magallanes">Magallanes y de la Ant√°rtica Chilena</option>
              </select>
            </div>
            <div class='col-md-6'>
              <label class='form-label'>Comuna</label>
              <select class='form-select' id='editComuna' required>
                <option value=''>- Seleccione la comuna -</option>
              </select>
            </div>
          </div>
          <div class='d-grid'>
            <button type='submit' class='btn btn-outline-dark'>REGISTRAR</button>
          </div>
        </form>
      `;
      // Script para comunas din√°micas
      const regionesComunas = {
        "Arica y Parinacota": ["Arica", "Camarones", "Putre", "General Lagos"],
        "Tarapac√°": ["Iquique", "Alto Hospicio", "Pozo Almonte", "Cami√±a", "Colchane", "Huara", "Pica"],
        "Antofagasta": ["Antofagasta", "Mejillones", "Sierra Gorda", "Taltal", "Calama", "Ollag√ºe", "San Pedro de Atacama", "Tocopilla", "Mar√≠a Elena"],
        "Atacama": ["Copiap√≥", "Caldera", "Tierra Amarilla", "Cha√±aral", "Diego de Almagro", "Vallenar", "Alto del Carmen", "Freirina", "Huasco"],
        "Coquimbo": ["La Serena", "Coquimbo", "Andacollo", "La Higuera", "Paiguano", "Vicu√±a", "Illapel", "Canela", "Los Vilos", "Salamanca", "Ovalle", "Combarbal√°", "Monte Patria", "Punitaqui", "R√≠o Hurtado"],
        "Valpara√≠so": ["Valpara√≠so", "Casablanca", "Conc√≥n", "Juan Fern√°ndez", "Puchuncav√≠", "Quintero", "Vi√±a del Mar", "Isla de Pascua", "Los Andes", "Calle Larga", "Rinconada", "San Esteban", "La Ligua", "Cabildo", "Papudo", "Petorca", "Zapallar", "Quillota", "La Calera", "La Cruz", "Nogales", "San Antonio", "Algarrobo", "Cartagena", "El Quisco", "El Tabo", "Santo Domingo", "San Felipe", "Catemu", "Llay Llay", "Panquehue", "Putaendo", "Santa Mar√≠a"],
        "Metropolitana": ["Cerrillos", "Cerro Navia", "Conchal√≠", "El Bosque", "Estaci√≥n Central", "Huechuraba", "Independencia", "La Cisterna", "La Florida", "La Granja", "La Pintana", "La Reina", "Las Condes", "Lo Barnechea", "Lo Espejo", "Lo Prado", "Macul", "Maip√∫", "√ëu√±oa", "Pedro Aguirre Cerda", "Pe√±alol√©n", "Providencia", "Pudahuel", "Puente Alto", "Quilicura", "Quinta Normal", "Recoleta", "Renca", "San Joaqu√≠n", "San Miguel", "San Ram√≥n", "Vitacura", "Pirque", "Puente Alto", "San Jos√© de Maipo", "Colina", "Lampa", "Tiltil", "Buin", "Calera de Tango", "Paine", "San Bernardo", "Alhu√©", "Curacav√≠", "Mar√≠a Pinto", "Melipilla", "San Pedro", "Talagante", "El Monte", "Isla de Maipo", "Padre Hurtado", "Pe√±aflor"],
        "O'Higgins": ["Rancagua", "Codegua", "Coinco", "Coltauco", "Do√±ihue", "Graneros", "Las Cabras", "Machal√≠", "Malloa", "Mostazal", "Olivar", "Peumo", "Pichidegua", "Quinta de Tilcoco", "Rengo", "Requ√≠noa", "San Vicente", "Pichilemu", "La Estrella", "Litueche", "Marchihue", "Navidad", "Paredones", "San Fernando", "Ch√©pica", "Chimbarongo", "Lolol", "Nancagua", "Palmilla", "Peralillo", "Placilla", "Pumanque", "Santa Cruz"],
        "Maule": ["Talca", "Constituci√≥n", "Curepto", "Empedrado", "Maule", "Pelarco", "Pencahue", "R√≠o Claro", "San Clemente", "San Rafael", "Cauquenes", "Chanco", "Pelluhue", "Curic√≥", "Huala√±√©", "Licant√©n", "Molina", "Rauco", "Romeral", "Sagrada Familia", "Teno", "Vichuqu√©n", "Linares", "Colb√∫n", "Longav√≠", "Parral", "Retiro", "San Javier", "Villa Alegre", "Yerbas Buenas"],
        "√ëuble": ["Cobquecura", "Coelemu", "Ninhue", "Portezuelo", "Quirihue", "R√°nquil", "Treguaco", "Bulnes", "Chill√°n", "Chill√°n Viejo", "El Carmen", "Pemuco", "Pinto", "Quill√≥n", "San Ignacio", "Yungay", "San Carlos", "San Fabi√°n", "San Nicol√°s"],
        "Biob√≠o": ["Concepci√≥n", "Coronel", "Chiguayante", "Florida", "Hualqui", "Lota", "Penco", "San Pedro de la Paz", "Santa Juana", "Talcahuano", "Tom√©", "Hualp√©n", "Lebu", "Arauco", "Ca√±ete", "Contulmo", "Curanilahue", "Los √Ålamos", "Tir√∫a", "Los √Ångeles", "Antuco", "Cabrero", "Laja", "Mulch√©n", "Nacimiento", "Negrete", "Quilaco", "Quilleco", "San Rosendo", "Santa B√°rbara", "Tucapel", "Yumbel", "Alto Biob√≠o"],
        "Araucan√≠a": ["Temuco", "Carahue", "Cunco", "Curarrehue", "Freire", "Galvarino", "Gorbea", "Lautaro", "Loncoche", "Melipeuco", "Nueva Imperial", "Padre Las Casas", "Perquenco", "Pitrufqu√©n", "Puc√≥n", "Saavedra", "Teodoro Schmidt", "Tolt√©n", "Vilc√∫n", "Villarrica", "Cholchol", "Angol", "Collipulli", "Ercilla", "Lonquimay", "Los Sauces", "Pur√©n", "Renaico", "Traigu√©n", "Victoria"],
        "Los R√≠os": ["Valdivia", "Corral", "Lanco", "Los Lagos", "M√°fil", "Mariquina", "Paillaco", "Panguipulli", "La Uni√≥n", "Futrono", "Lago Ranco", "R√≠o Bueno"],
        "Los Lagos": ["Puerto Montt", "Calbuco", "Cocham√≥", "Fresia", "Frutillar", "Los Muermos", "Llanquihue", "Maull√≠n", "Puerto Varas", "Castro", "Chonchi", "Curaco de V√©lez", "Dalcahue", "Puqueld√≥n", "Queil√©n", "Quell√≥n", "Quemchi", "Quinchao", "Osorno", "Puerto Octay", "Purranque", "Puyehue", "R√≠o Negro", "San Juan de la Costa", "San Pablo"],
        "Ays√©n": ["Coyhaique", "Lago Verde", "Ays√©n", "Cisnes", "Guaitecas", "R√≠o Ib√°√±ez", "Chile Chico", "Cochrane", "O'Higgins", "Tortel"],
        "Magallanes": ["Punta Arenas", "Laguna Blanca", "R√≠o Verde", "San Gregorio", "Cabo de Hornos", "Ant√°rtica", "Porvenir", "Primavera", "Timaukel", "Natales", "Torres del Paine"]
      };
      document.getElementById('editRegion').addEventListener('change', function() {
        const region = this.value;
        const comunaSelect = document.getElementById('editComuna');
        comunaSelect.innerHTML = '<option value="">- Seleccione la comuna -</option>';
        if (regionesComunas[region]) {
          regionesComunas[region].forEach(comuna => {
            const option = document.createElement('option');
            option.value = comuna;
            option.textContent = comuna;
            comunaSelect.appendChild(option);
          });
        }
      });
      // Si ya hay regi√≥n y comuna, seleccionarlas
      if (u.region) {
        document.getElementById('editRegion').value = u.region;
        const event = new Event('change');
        document.getElementById('editRegion').dispatchEvent(event);
        if (u.comuna) {
          document.getElementById('editComuna').value = u.comuna;
        }
      }
      document.getElementById('formEditarUsuario').onsubmit = function(e) {
        e.preventDefault();
        // Validaciones b√°sicas
        const nombre = document.getElementById('editNombre').value;
        const correo1 = document.getElementById('editCorreo1').value;
        const correo2 = document.getElementById('editCorreo2').value;
        const password1 = document.getElementById('editPassword1').value;
        const password2 = document.getElementById('editPassword2').value;
        const telefono = document.getElementById('editTelefono').value;
        const region = document.getElementById('editRegion').value;
        const comuna = document.getElementById('editComuna').value;
        if (correo1 !== correo2) {
          alert('Los correos no coinciden.');
          return;
        }
        if (password1 !== password2) {
          alert('Las contrase√±as no coinciden.');
          return;
        }
        usuarios[idx] = {
          nombre,
          correo: correo1,
          clave: password1,
          telefono,
          region,
          comuna
        };
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        cargarUsuarios();
        document.getElementById('editar-form').innerHTML = '<div class="alert alert-success">Usuario actualizado.</div>';
      };
    }
    document.addEventListener('DOMContentLoaded', cargarUsuarios);
  </script>
</body>
</html>
