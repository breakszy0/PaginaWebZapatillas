<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Usuario - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark shadow-sm mb-4">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="admin.html">👟 Admin Panel</a>
      <a class="btn btn-light btn-sm ms-auto" href="admin.html">Volver</a>
    </div>
  </nav>
  <div class="container py-4">
    <h2 class="mb-4">Editar Usuario</h2>
    <div id="usuarios-lista"></div>
    <div id="editar-form" class="mt-4"></div>
  </div>
  <script>
    function cargarUsuarios() {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const lista = document.getElementById('usuarios-lista');
      if (!usuarios.length) {
        lista.innerHTML = '<div class="alert alert-info">No hay usuarios para editar.</div>';
        return;
      }
      lista.innerHTML = '<h5>Selecciona un usuario para editar:</h5>' + usuarios.map((u, idx) => `
        <div class='card mb-2 p-2'>
          <b>${u.nombre}</b> (${u.correo})
          <button class='btn btn-warning btn-sm ms-2' onclick='editarUsuario(${idx})'>Editar</button>
        </div>
      `).join('');
    }
    function editarUsuario(idx) {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      const u = usuarios[idx];
      document.getElementById('editar-form').innerHTML = `
        <form id='formEditarUsuario' class='border rounded-4 shadow-lg p-4 bg-white mx-auto' style='max-width: 600px;'>
          <div class='mb-3'><label class='form-label'>NOMBRE COMPLETO</label><input class='form-control' id='editNombre' value='${u.nombre || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CORREO</label><input class='form-control' id='editCorreo1' value='${u.correo || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CORREO</label><input class='form-control' id='editCorreo2' value='${u.correo || ''}' required></div>
          <div class='mb-3'><label class='form-label'>CONTRASEÑA</label><input type='password' class='form-control' id='editPassword1' value='' required></div>
          <div class='mb-3'><label class='form-label'>CONFIRMAR CONTRASEÑA</label><input type='password' class='form-control' id='editPassword2' value='' required></div>
          <div class='mb-3'><label class='form-label'>TELÉFONO (opcional)</label><input class='form-control' id='editTelefono' value='${u.telefono || ''}'></div>
          <div class='row mb-3'>
            <div class='col-md-6'>
              <label class='form-label'>Región</label>
              <select class='form-select' id='editRegion' required>
                <option value=''>- Seleccione la región -</option>
                <option value='Metropolitana'>Región Metropolitana de Santiago</option>
                <option value='Araucania'>Región de la Araucanía</option>
                <option value='Ñuble'>Región de Ñuble</option>
              </select>
            </div>
            <div class='col-md-6'>
              <label class='form-label'>Comuna</label>
              <select class='form-select' id='editComuna' required>
                <option value=''>- Seleccione la comuna -</option>
                <option value='Linares'>Linares</option>
                <option value='Longaví'>Longaví</option>
                <option value='Concepción'>Concepción</option>
              </select>
            </div>
          </div>
          <div class='d-grid'>
            <button type='submit' class='btn btn-outline-dark'>REGISTRAR</button>
          </div>
        </form>
      `;
      document.getElementById('formEditarUsuario').onsubmit = function(e) {
        e.preventDefault();
        // Validaciones básicas
        const nombre = document.getElementById('editNombre').value;
        const correo1 = document.getElementById('editCorreo1').value;
        const correo2 = document.getElementById('editCorreo2').value;
        const password1 = document.getElementById('editPassword1').value;
        const password2 = document.getElementById('editPassword2').value;
        const telefono = document.getElementById('editTelefono').value;
        const region = document.getElementById('editRegion').value;
        const comuna = document.getElementById('editComuna').value;
        if (correo1 !== correo2) {
          alert('Los correos no coinciden.');
          return;
        }
        if (password1 !== password2) {
          alert('Las contraseñas no coinciden.');
          return;
        }
        usuarios[idx] = {
          nombre,
          correo: correo1,
          clave: password1,
          telefono,
          region,
          comuna
        };
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        cargarUsuarios();
        document.getElementById('editar-form').innerHTML = '<div class="alert alert-success">Usuario actualizado.</div>';
      };
    }
    document.addEventListener('DOMContentLoaded', cargarUsuarios);
  </script>
</body>
</html>
